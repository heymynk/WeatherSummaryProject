<template>
    <lightning-card>
      <div class="slds-var-p-around_medium" style="margin-top: -0.75rem">
        <template if:true={isLoading}>
          <div class="slds-is-relative slds-var-p-around_medium">
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
            <div class="slds-align_absolute-center slds-text-align_center">
              <p>{loadingMessage}</p>
            </div>
          </div>
        </template>
  
        <template if:false={isLoading}>
          <template if:true={additionalPrompt}>
            <!-- Textarea for additional prompts -->
            <lightning-textarea
              label="Additional Prompt"
              name="customPromptByUser"
              value={customPromptByUser}
              onchange={handleInputChange}
              placeholder="Enter additional instructions or information here..."
              class="slds-var-m-bottom_small"
            >
            </lightning-textarea>
          </template>
  
          <div class="slds-text-align_left slds-var-p-top_medium">
            <!-- Generate Email button -->
            <template if:true={showGenerateEmailButton}>
              <lightning-button
                label="Generate Email"
                variant="brand"
                icon-name="utility:email"
                icon-position="left"
                onclick={generateEmail}
                class="slds-var-m-right_x-small slds-var-m-bottom_small"
              >
              </lightning-button>
            </template>
  
            <!-- Email fields -->
            <template if:true={showEmailFields}>
              <lightning-input
                label="to"
                name="toAddress"
                value={toAddress}
                onchange={handleInputChange}
                placeholder="Enter the email here..."
                class="slds-var-m-bottom_small slds-var-p-top_small"
              >
              </lightning-input>
  
              <lightning-input
                label="Email Subject"
                name="subject"
                value={subject}
                onchange={handleInputChange}
                placeholder="Enter the email subject here..."
                class="slds-var-m-bottom_small"
              >
              </lightning-input>
  
              <lightning-input-rich-text
                label="Generated Email Content"
                value={emailContent}
                onchange={handleInputChange}
                class="slds-var-m-bottom_small"
              >
              </lightning-input-rich-text>
  
              <lightning-file-upload
                label="Attach Files"
                name="uploadFile"
                accept={acceptedFormats}
                record-id={recordId}
                onuploadfinished={handleUploadFinished}
                multiple
                class="slds-var-m-bottom_small"
              >
              </lightning-file-upload>
  
              <!-- Display uploaded files as pills -->
              <template if:true={uploadFile}>
                <div class="slds-var-p-around_small slds-grid slds-wrap">
                  <template for:each={uploadFile} for:item="fileIterator">
                    <lightning-pill
                      class="slds-var-m-right_x-small slds-var-m-bottom_x-small"
                      key={fileIterator.contentVersionId}
                      label={fileIterator.name}
                      data-id={fileIterator.contentVersionId}
                      onremove={fileRemove}
                    >
                    </lightning-pill>
                  </template>
                </div>
              </template>
  
              <div class="slds-button-group">
                <lightning-button
                  label="Send Email"
                  variant="brand"
                  icon-name="utility:send"
                  icon-position="left"
                  onclick={sendEmail}
                  class="slds-var-m-right_x-small"
                >
                </lightning-button>
  
                <lightning-button
                  label="Regenerate Email"
                  variant="neutral"
                  icon-name="utility:refresh"
                  icon-position="left"
                  onclick={regenerateEmail}
                  class="slds-var-m-right_x-small"
                >
                </lightning-button>
              </div>
            </template>
          </div>
        </template>
      </div>
    </lightning-card>
  </template>
  